<!DOCTYPE html>
<html lang="en" class="h-100">

<head>

    <meta charset="utf-8">
    <link rel="icon" href="http://obj-cache.cloud.ruanbekker.com/favicon.ico">
    <!--<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css" rel="stylesheet">-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    <link rel="stylesheet" href="{{ url_for('static', filename='styles/style.css') }}">
    <script src="https://cdn.plyr.io/3.7.3/plyr.js"></script>
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.3/plyr.css" />

    <title>Results</title>

</head>

<body>
    
    <br><br>
    <div class="container" style="margin-top: auto; margin-bottom: auto; padding-bottom: 5%"">
        <h1 align="center">
            <a href="/">PodMagic</a>
            
        </h1>
        <p align="center">Podcast search, with superpowers.</p>
        <br>
        <form class="d-flex" action="/search/results" method="post">
            <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" name="input" autofocus>
            <button class="btn btn-outline-success" type="submit">Search</button>
        </form>

        <br>
        <hr>
        <center>
            <p style="text-align: center;"><b>"{{ input }}"</b></p>
            <p style="text-align: center;"> {{ res['hits']['total']["value"] }} results</p>
        </center>
        <br> 
        <!-- if there are results -->
        {% if res['hits']['total']["value"] > 0 %}

            {% for hit in res['hits']['hits'] %}

            {% set url_audio = hit['_source']['episode_audio_link'] %}
            {% set podcast_title = hit['_source']['episode_title'] %}

            <div class="card mb-3" style="max-width: 100%;">
                <div class="row g-0 vertical-center">
                    <div class="col-sm-2 ">
                    <img src="{{ hit['_source']['episode_artwork_link'] }}" class="img-fluid rounded" alt="artwork" style="max-width: 100%; vertical-align: middle;">
                    </div>
                    <div class="col-md-10">
                    <div class="card-body">
                        <h5 class="card-title">{{ hit['_source']['episode_title'] }}</h5>
                        <p class="card-text">...{{ hit['highlight']['episode_description_clean'][0][:200] if 'episode_description_clean' in hit['highlight'] else hit['_source']['episode_description_clean'][:200] |safe }}...</p>
                        <p class="card-text"><small class="text-muted">{{ hit['_source']['episode_pub_date']}}</small></p>
                        <button onclick="update_url_source('{{ url_audio }}', '{{ podcast_title }}')" class="btn btn-primary">Listen</button>
                        
                    </div>
                    
                    </div>
                </div>
                
            </div>
            {% endfor %}
        {% else %}
            <p>No results found.</p>
        {% endif %}
        
        <br>
        <br>
        <br>
        

    </div>
    <div class="footer d-flex flex-column h-100" style="position: fixed; left: 0; top: 90%;  z-index: 999999; width: 100%; height: 10%; background-color: #FFF; text-align: center;">
        <p style="visibility: none" >Now playing: <span id="now_playing">...</span></p>
        <audio id="player" controls>
            <source src="" type="audio/mpeg">
        </audio>
    </div>
</body>


<script>
    const player = new Plyr('#player', {
        title: 'Now playing',
      });

    // update source
    function update_url_source(url, title) {
        player.source = {
            type: 'audio',
            sources: [{
                src: url,
                type: 'audio/mpeg',
            }],
        };
        player.play();
        document.getElementById("now_playing").innerHTML = title;
    }


  </script>

</html>